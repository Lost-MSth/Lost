import gmpy2


n = 29696534944763086906527821690429487526295096132469922907629703955811154042599106992350304881014343981237864023096354163196156358630185701125962991918149308703125979501637121785419938825712962002077413313672148268550356354626570412269377053780394874841237653690876851336491320230802675799329980392716599537233038580890283312472159652135363937566091118882268963822413357077282662011460022853934907395553568447784064915853538865028772078895169093750424241293958618751823831234180034347343224680863439318682616944626873027344616106879980805730643686599932959020513602810363735339450593447263542344238319193995131354995649
e = 65537
x0 = 13736509514406706389925817054040162206755498095630734722545166074206059470083138857773224606444497733770143791624193756767191954586158034222379415481461424599091118310279952054559295929678467772317798052251613246877874976226992480712040062802977427161338371336924911322032023350398122200816196823294417347185670457451496166162705622753570374284501153952587870234682541748093302844005641832929245088356796992458655204748688064841663913989459542074304006138782278101590526895540088438913433678416869452958231308565975901185233603939742545034692900422396479136219348995896731045169676462848988469504672858133409481426512
x1 = 28416712958113749239199442586920271280109806830506051381193508662687291910170006677374845580179500541356290900898439318991988895676642336851642327572586102902731878848393334736277344517736399986710038888436991558706570323620462496084684748278221682282474276096008024575078975638230928671947873235597497949116289301584690928968228223673588190925984487752186858859194052300449918813709949766614405378991895149608096373745259612547392890209583127114955567355825369797488080012920118710479654050127268936725031782019868609427186713530640802703020449132497125548685065016919962212200751896668587885549981873775266160904014

assert (x0 + x1) % 2 == 0, "(x0 + x1) is not even"

v = (x0 + x1) // 2
x = (x0 - x1) // 2

print("v: ", v)

# Copy it to console and get v0 & v1

v0 = 26838543041643041454692371072703187594557030287020324223984271125376182695606742390653994896523782165871888815239217371016061488936803107307147490830452529718349672347691158491576523735551819262024510526453110169987159809784018596031828367658907672136366918063400143842801132100320349940947585712595637610676421146990225260433461624843237977892733396233183567948808334845330150600847681562980365534360145560384695082182422825622636311360080589183056925328111794933114951508919402606425308535017275500609708893243106411200649336772284653497209398903306928224341716135735862470350576892473200927422362552358638544480191
v1 = 19144557812377433903492441773857161980752393227469647340070874111014557430807392202021322107248053620203430676028489900551205107276778440304777562728845386790339133843664128366677738476917861542135797796005189482518390354320589712276724640159372372347035496414468843814118180650290901219402336261579607876138671118936734551149282647980057260490377437316681485972238389671223680659404290519858119813436315375402895192707856274495762623210497988249646931776203842129126002375942209567779138495328078653709735289592247123818047862212568645569115466985930192271420644106606422543053085735800167691604863836215889401547688


u_e = pow(v0 - v1, e, n)

kq = (u_e + x * pow(2, e, n)) % n
print("k * q: ", kq)

# n = p * q, kq = k * q, so q = gcd(n, kq)
q = gmpy2.gcd(n, kq)

p = n // q

print("kq | n: ", n // kq * kq == n)

assert p * q == n, "p * q != n"

print("p: ", p)
print("q: ", q)

phi = (p - 1) * (q - 1)
d = pow(e, -1, phi)
print("d: ", d)

f = (v0 - pow(v-x0, d, n) - pow(p+q, d, n)) % n
print(f.to_bytes(128, "big"))
